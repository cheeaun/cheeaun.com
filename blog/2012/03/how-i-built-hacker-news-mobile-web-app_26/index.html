<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>How I built the Hacker News mobile web app, Part 2 &ndash; Lim Chee Aun</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/assets/cheeaun.css?12c6kc8">
<link rel="preload" href="/assets/fonts/WorkSans-Regular.woff2" as="font" type="font/woff2">
<meta name="fediverse:creator" content="@cheeaun@mastodon.social">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="How I built the Hacker News mobile web app, Part 2">
<meta name="description" property="og:description" content="This is continued from the first part.Before I begin, I would like to mention that I&#x27;m very surprised by the amazing response on the first articleâ€¦">

<link rel="alternate" href="/blog/feed.xml" type="application/atom+xml" title="cheeaunblog">
<link rel="manifest" href="/manifest.webmanifest">
<link rel="apple-touch-icon" href="/assets/images/icon-192.png">
<meta name="color-scheme" content="light dark"><div id="container">
  <header class="site-header">
    <a href="/" rel="home"><svg width="120" height="120" viewBox="0 0 225 225">
    <title>Lim Chee Aun</title>
    <circle cx="112.5" cy="112.5" r="112.5" fill="#fa8e01"/>
    <path fill="#fff" d="M104.8 127.1c-.8.4-1.9.9-3 1.3-1.2.5-2.4.9-3.6 1.2-1.2.3-2.3.5-3.3.5-3 0-5.3-1.5-7-4.7-1.6-3.1-2.5-7.8-2.5-13.9 0-4.3.4-7.6 1.2-9.9.7-2.3 1.8-4 3.2-4.9 1.3-1 2.9-1.4 4.7-1.3 1.2-.1 2.7.1 4.4.5 1.8.4 3.7 1.1 5.7 2.2l3.3-15.5c-2.7-.9-5.3-1.5-8-1.9-2.5-.3-4.8-.5-6.8-.5-5.8 0-10.7 1.1-14.8 3.3-4.1 2.2-7.2 5.7-9.4 10.7-2.1 4.8-3.2 11.2-3.3 19.2 0 10.8 2.1 18.8 6.3 24 4.1 5.2 10.2 7.8 18.3 7.8 2.2 0 4.4-.1 6.6-.5 2.2-.3 4.3-.8 6.3-1.4 2-.6 3.7-1.3 5.2-2.1l-3.5-14.1zm54.5 16.9c-.2-1.8-.5-3.8-.8-6.1-.2-2.2-.4-4.5-.6-7-.2-2.4-.3-4.9-.3-7.3v-23c0-2.9-.3-5.6-1-8.1-.6-2.5-1.8-4.7-3.3-6.6-1.6-1.9-3.9-3.4-6.7-4.5-2.8-1-6.3-1.6-10.6-1.6-3.5 0-7.1.4-10.7 1.1-3.6.8-7.3 1.8-11 3.1l3.7 14c3.1-1.2 5.8-2.1 8.2-2.8 2.5-.6 4.5-.9 6.1-.9 1.8 0 3.3.5 4.4 1.4 1.2 1 1.8 2.6 1.8 4.9v7.7c-3.8.3-7.2.8-10.4 1.6s-6 1.9-8.4 3.3c-2.4 1.5-4.3 3.4-5.7 5.8-1.3 2.3-2 5.1-2 8.5 0 2.3.2 4.5.7 6.7.5 2.1 1.3 4 2.4 5.6 1.1 1.7 2.5 3 4.1 3.9 1.7 1 3.6 1.5 5.9 1.5 2.6 0 4.9-.4 6.9-1.2 2.1-.8 3.9-1.8 5.6-2.9 1.6-1.1 3.1-2.2 4.6-3.3l1.5 6.2h15.6zm-20.7-14.9c-.9.8-1.8 1.4-2.6 1.9s-1.6.7-2.5.7c-1.4 0-2.5-.6-3.4-1.8-.8-1.2-1.3-2.8-1.3-5 0-1.7.5-2.9 1.4-3.8 1-.8 2.2-1.4 3.7-1.7 1.5-.3 3-.6 4.7-.7v10.4z"/>
    <circle cx="112.5" cy="112.5" r="83.7" fill="none" stroke="#fff" stroke-width="20.1"/>
  </svg>
  </a>
  </header>  <div id="content">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header><h1 itemprop="heading">How I built the Hacker News mobile web app, Part 2</h1><time datetime="2012-03-26" class="meta date" itemprop="datePublished">26 March 2012</time></header><div itemprop="articleBody"><p>This is continued from the <a href="/blog/2012/03/how-i-built-hacker-news-mobile-web-app">first part</a>.</p><p>Before I begin, I would like to mention that I&apos;m very surprised by the <strong>amazing response</strong> on the first article and the <strong>massive traffic</strong> hitting my site. It was seriously unexpected and <strong>quite meta</strong>.</p><figure><a href="/blog/images/screenshots/web/hacker-news-web-app-blog-article-meta.png"><img src="/blog/images/screenshots/web/hacker-news-web-app-blog-article-meta-thumbnail.png" alt="Hacker News Mobile web app showing the first article" width="320" height="480"></a></figure><p>The first part puts focus on the look and feel of the app. For this second part, I&apos;ll provide an addendum on some new things I found and various details on the development of the app.</p><h2>iOS imitation</h2><p>In the first article, I mentioned an example of rendering the Back button in pure CSS without images. It doesn&apos;t look that good and has artifacts on it. Well, there exists a way, way better implementation by Gregor Adams. It is <a href="http://dream-world.us/2011/11/30/the-best-pure-css3-ios-style-arrow-back-button/" title="the best pure CSS3 iOS style arrow Back button"><strong>the best</strong> pure CSS iOS Back button</a> I&apos;ve ever seen. Here&apos;s a comparison:</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-back-button-better-css-native.png" alt="Native iOS navigation bar Back button and one done in pure CSS, zoomed in 5 times" width="410" height="240"></figure><p>No artifacts and smooth edges. No images are used at all. It uses <strong>a lot</strong> of fancy CSS properties to achieve this almost exact replica.</p><p>This also leads me to discover even more impressive work by others who tried to mimic the iOS interface, such as <a href="http://cssuikit.com/">CSSUIKit</a> and <a href="http://webkit-os.pixelass.com/">-webkit-OS</a>. I find -webkit-OS very interesting because it also replicate the look of the iOS Lock screen and Springboard, including slide-to-unlock and wiggling icons!</p><figure><a href="/blog/images/screenshots/web/webkit-os-lock-screen.png"><img src="/blog/images/screenshots/web/webkit-os-lock-screen-thumbnail.png" alt="-webkit-OS Lock screen" width="320" height="480"></a></figure><p>The screenshot above is <a href="http://webkit-os.pixelass.com/">-webkit-OS</a>, a <strong>web page</strong>. The date and time is live, and you can slide to unlock to see the Springboard. The status bar is slightly translucent because of this code:</p><pre><code>&lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black-translucent&quot;&gt;
</code></pre><p>It works only on WebKit and I got to admit, it&apos;s really awesome.</p><h2>Standalone mode</h2><p>HNmobile doesn&apos;t launch in standalone mode. If you add it to your Home screen and launch it, it will open in Mobile Safari. It&apos;s not that I can&apos;t make it work, HNmobile is just the type of app that <strong>doesn&apos;t work well</strong> as a &apos;standalone&apos; app. Why? How do you define a &apos;standalone&apos; app?</p><p>From my observations, standalone mode only works for web apps that let users do <em>everything</em> in it. For HNmobile, you can read stories and comments. To view a story link, it <em>has</em> to open in Mobile Safari. <em>That</em> is no longer &apos;standalone&apos; because you can&apos;t preview a link <em>inside</em> the web app. This is the reason why HNmobile doesn&apos;t launch in standalone mode and in the end, it turns out the app works <strong>better</strong> inside Mobile Safari instead.</p><p>So, what type of apps are suitable to be &apos;standalone&apos;? Two examples.</p><figure><a href="/blog/images/screenshots/web/doubbble-web-app.png"><img src="/blog/images/screenshots/web/doubbble-web-app-thumbnail.png" alt="Doubbble mobile web app" width="320" height="480"></a></figure><p>First, this is <a href="http://doubbble.com/">Doubbble</a> by <a href="http://deaxon.com/">Benjamin De Cock</a>. It&apos;s a <a href="http://dribbble.com/">Dribbble</a> viewer mobile web app. You may notice that Mobile Safari&apos;s toolbar is gone, that&apos;s standalone mode. You can view popular Dribbble shots or &apos;Following&apos; shots, view individual shots and swipe through them. If given the time and effort to implement more of <a href="http://dribbble.com/api">Dribbble&apos;s API</a>, you can do pretty much anything <strong>without leaving the app</strong>.</p><figure><a href="/blog/images/screenshots/web/messenger-web-app.png"><img src="/blog/images/screenshots/web/messenger-web-app-thumbnail.png" alt="Messenger mobile web app" width="320" height="480"></a></figure><p>Second, this is <a href="https://github.com/Harrison/Messenger">Messenger</a> by Philip Harrison, a mobile web app which I happen to find on GitHub. It&apos;s basically a clone of the iOS built-in Messages app. It&apos;s not really a working app, but it demonstrates the possibility of building a messaging or chatting mobile application. You can browse through messages, tap on them and see the whole thread. It even has pull-to-refresh, implemented together with <code>-webkit-overflow-scrolling: touch</code>.</p><p>These two example applications show content that can be consumed <strong>internally</strong>. For HNmobile, the story links, which is the main content, are <strong>external</strong>, requiring the user to launch them in another application. There may be external content as well for Messenger such as messages with URLs. That is okay because it&apos;s not the <strong>main</strong> content. Even the native Messages app launches links in Mobile Safari instead of a built-in browser.</p><p>Of course, this only applies to iOS-specific mobile web apps and if you&apos;re building one, remember to keep this in mind. As long as there&apos;s no way for me to <em>simulate</em> a built-in browser in a web app, HNmobile will remain being a non-standalone app.</p><h2>Navigation bar</h2><p>I&apos;m always fascinated by the way iOS navigation bar layout works. It looks simple, yet <em>not quite</em> simple. Here&apos;s a simple sketch of the navigation bar layout with buttons:</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch.png" alt="Sketch of iOS navigation bar layout" width="340" height="64"></figure><p>The HTML code, in the most minimal form:</p><pre><code>&lt;header&gt;
    &lt;a href=&quot;#&quot;&gt;Back&lt;/a&gt;
    &lt;h1&gt;Title&lt;/h1&gt;
    &lt;a href=&quot;#&quot;&gt;Button&lt;/a&gt;
&lt;/header&gt;
</code></pre><p>Initially, I didn&apos;t expect much and plan to just code this in a quick and easy way. Instead of using floats or other common CSS layout techniques, I experimented using the <a href="http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/">CSS Flexible Box Layout</a>. Note that the one I use is the old standard, while <a href="http://dev.w3.org/csswg/css3-flexbox/">the new one</a> has debuted in some recent browsers. I suggest reading Paul Irish&apos;s article on <a href="http://www.html5rocks.com/en/tutorials/flexbox/quick/">Quick hits with the Flexible Box Model</a> to understand the implementation, before reading this.</p><p>Here&apos;s how it looks like:</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-css-flex-box.png" alt="Sketch of iOS navigation bar layout, done with CSS Flexible Box Layout" width="340" height="106"></figure><p>The CSS code <code>box-flex: 1</code> will make the title container, in this case the <code>h1</code> element, <strong>grow</strong> to fill the space. It works great, except for few cases. If one of the navigation bar buttons changes in width, the text alignment is shifted.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-text-alignment-1.png" alt="Sketch of iOS navigation bar layout, text alignment shifted due to shorter button" width="340" height="160"></figure><p>If the button is not there, it&apos;s also shifted.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-text-alignment-2.png" alt="Sketch of iOS navigation bar layout, text alignment shifted due to a missing button" width="340" height="160"></figure><p>Same thing applies if one of the buttons got wider.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-text-alignment-3.png" alt="Sketch of iOS navigation bar layout, text alignment shifted due to a wider button" width="340" height="160"></figure><p>On iOS, the navigation bar title doesn&apos;t shift regardless of these minor layout changes. It should still maintain being at the center of the navigation bar and not <em>pushed</em> by the buttons. Interestingly, using CSS floats have the <em>same issue</em> as flexible box too, so I try absolute positioning on the buttons instead.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-position-absolute.png" alt="Sketch of iOS navigation bar layout, using CSS absolute positioning on the buttons" width="340" height="106"></figure><p>Now, the title text will <strong>always</strong> be in the center because absolute-positioned buttons will not affect it anymore. But when the text becomes <em>too long</em>, the title text goes <em>under</em> the buttons and they overlap over it.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-button-overlap-1.png" alt="Sketch of iOS navigation bar layout, longer title text overlapped by the buttons" width="340" height="160"></figure><p>Longer buttons can also overlap on the title.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-button-overlap-2.png" alt="Sketch of iOS navigation bar layout, title text overlapped by longer buttons" width="340" height="160"></figure><p>On iOS, even though the title alignment is not affected by the minor changes in the button width on both sides, it will eventually shift <em>if</em> the button becomes too long and <em>intrudes</em> the title&apos;s space. In the diagram above, the title becomes <em>left-aligned</em> along the Back button, and it seems like it still <strong>tries to be in the center</strong> of the navigation bar.</p><p>I try to fix the overlapping problem by applying some CSS margins:</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-position-absolute-margin.png" alt="Sketch of iOS navigation bar layout, using absolute positioning and margins" width="340" height="170"></figure><p>Remember that the left and right margins still have to be (almost) the same so that it won&apos;t shift the title like the first few diagrams above. And I have to hardcode them, knowing the width of the buttons in the first place. The title is also applied with <code>text-overflow: ellipsis</code> so that longer text will be clipped and shows the ellipsis character.</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-correct-text-alignment.png" alt="Sketch of iOS navigation bar layout, all rendered correctly thanks to absolute positioning and margins" width="340" height="240"></figure><p>HNmobile currently uses this technique. It works in <em>most</em> cases, fortunately. The obvious case where it <em>doesn&apos;t</em> work correctly is when the title is long and there&apos;s no button on the right side:</p><figure><img src="/blog/images/figures/interface/ios-navigation-bar-sketch-incorrect-text-alignment.png" alt="Sketch of iOS navigation bar layout, title text clipped even when there&apos;s no button on the right" width="340" height="160"></figure><p>Here you&apos;ll see that if the title is long and there&apos;s space around it, iOS will fill it up. Makes sense.</p><p>These are all the use cases I found when developing HNmobile, and there could be more other interesting ones. In the end, to implement this <strong>correctly</strong>, the layout has be done <strong>programmatically</strong> with JavaScript, not to mention that you still have to animate them when switching between pages. I hate to say this but this flexible layout just <strong>can&apos;t be done</strong> in pure 100% CSS, judging from my current knowledge of whatever CSS grid, positioning or text module specifications out there.</p><p>Putting things in perspective, this is <em>merely</em> a navigation bar, which takes up only <strong>10%</strong> of the iPhone screen. It&apos;s simply remarkable that there&apos;s so much attention to detail in this.</p><h2>Application Cache</h2><p>HNmobile uses <a href="http://html5doctor.com/go-offline-with-application-cache/" title="Go offline with application cache">Application Cache</a> for caching resources locally in the browser. It results in much faster subsequent page loads because practically no requests are done except to check for updated manifest file. It&apos;s amazing that GitHub sends the correct MIME type for manifest files, which is <code>text/cache-manifest</code>, else I wouldn&apos;t be able to host HNmobile on <a href="http://pages.github.com/">GitHub Pages</a>.</p><p>For the past few weeks, I&apos;ve deployed a number of updates and recently started using Google Analytics to track the update rate. To update the manifest file, the common technique is to add version numbers, like this:</p><pre><code>CACHE MANIFEST
# version 1

CACHE
index.html
hn.css
...
</code></pre><p>However, the problem is, by just looking at the version number, you don&apos;t know <em>when</em> the update was deployed. A good tip here would be to use date strings, <em>together</em> with version numbers, just in case you like version numbers:</p><pre><code>CACHE MANIFEST
# 2012-03-25:v1

CACHE
index.html
hn.css
...
</code></pre><p>Then I pass this to Google Analytics with <a href="http://code.google.com/apis/analytics/docs/tracking/eventTrackerGuide.html">Event Tracking</a> so that I can see the version distribution among HNmobile users.</p><figure><img src="/blog/images/screenshots/web/google-analytics-hnmobile-version-distribution.png" alt="HNmobile version distribution tracked with Google Analytics" width="410" height="285"></figure><p>This is really useful for me to debug certain issues with Application Cache and find ways to make the updates propagate faster to users. As what <a href="http://www.stevesouders.com/blog/2011/10/03/improving-app-cache/" title="Improving app cache">most Mobile Gurus stated</a>, Application Cache can be pretty <em>clumsy</em>. I still don&apos;t understand why there are less than 10% of users having the older version of the cache. Hopefully this tracking will help me uncovering the mysteries.</p><h2>Error logging</h2><p>Sometimes, it&apos;s hard to track client-side errors and exceptions. It may work well on your device, but strangely break on others. It&apos;s especially hard to debug because that device is not in your hands. There are ways to do <a href="http://blog.pamelafox.org/2011/10/client-side-error-logging.html" title="Client-Side Error Logging">client-side error logging</a>, either to your own server or remotely with third-party services like <a href="http://errorstack.appspot.com/">ErrorStack</a>, <a href="http://jserrlog.appspot.com/">jsErrLog</a> and <a href="http://errorception.com/">Errorception</a>. I decided to use <a href="http://www.muscula.com/">Muscula</a> for HNmobile, which is currently free so that I can get a rough idea on how it works.</p><figure><img src="/blog/images/screenshots/web/muscula-hnmobile-error-log.png" alt="HNmobile error log tracked with Muscula" width="540" height="200"></figure><p>After running it for weeks, first thing I realise is that it doesn&apos;t quite work with minified JavaScript files because the error is always reported at line number 1. <a href="http://errorception.com/makethemost" title="Making the most of Errorception">Errorception mentioned this solution</a>:</p><blockquote>
<p>Instruct your minifier to preserve line-breaks in your minified code. There are two good reasons for this. Firstly, it makes line numbers actually meaningful in your bug reports. Secondly, when you do find an error it becomes very easy to debug even on production through a tool like Firebug or WebInspector.</p>
<p>&#x2014; <a href="http://errorception.com/makethemost">http://errorception.com/makethemost</a></p>
</blockquote><p>I&apos;m not sure if I&apos;ll do that, so I just leave it for now.</p><p>Besides that, there&apos;s also a bunch of errors that you need to specifically <em>ignore</em> because they are usually caused by browser extensions and social media widgets. Pamela Fox has <a href="https://gist.github.com/1878283">compiled a list errors to be ignored in this gist</a>, which I think is worth a read.</p><p>I believe this is the most interesting error message of all:</p><pre><code>ReferenceError: Can&apos;t find variable: atomicFindClose
</code></pre><p>Even Google <a href="http://www.google.com/search?q=%22atomicFindClose%22">can&apos;t figure it out</a>.</p><h2>Miscellaneous</h2><p>HNmobile uses <a href="https://github.com/cheeaun/node-hnapi">node-hnapi</a>, yet another unofficial API for Hacker News, which I built as an excuse to learn Node.js. It&apos;s hosted on <a href="http://www.heroku.com/">Heroku</a> and uses <a href="http://redis.io/">Redis</a> for caching the JSON responses. Since it&apos;s hosted on another domain, the API supports <a href="http://enable-cors.org/">CORS</a> so that HNmobile can do cross-domain <code>XMLHttpRequest</code>s. CORS require an interplay of server and client, and it only <a href="http://caniuse.com/cors">works on newer web browsers</a>. Fortunately, Mobile Safari supports it, so that make things easier. The API is quite experimental for now, so expect it to be down few times when the load is high.</p><p>Another very interesting observation in the statistics reveal that some of the users are on iPad. I expect HNmobile works there too, even on the new iPad&apos;s Retina display. The problem is it&apos;s not <em>optimized</em> for the larger screen real estate. Tim Cook mentioned in a <a href="http://www.apple.com/apple-events/march-2012/">recent Apple event</a> that iPad apps work great because they don&apos;t look like a blown-up, stretched-out smartphone app. Embarassingly, HNmobile <a href="https://twitter.com/ronalddevera/statuses/181272614197673985">looks like that right now</a>.</p><p>More improvements are definitely coming to HNmobile. The app is released under the MIT license, so feel free to <a href="https://github.com/cheeaun/hnmobile">fork and report issues on GitHub</a>. A <strong>big thanks</strong> to all users and everyone giving me valuable feedback.</p><p><strong>Update 27 March 2012</strong>: <a href="http://news.ycombinator.com/item?id=3756771">HN post here.</a></p><p><strong>Update 26 December 2012</strong>: <a href="/blog/2012/12/introducing-hackerweb">This app is now called HackerWeb.</a></p></div>
      </article>
  </div>
  <footer>
    <nav>
      <ul>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/projects/">Projects</a></li>
        <li><a href="/about/">About</a></li>
      </ul>
    </nav>
  </footer></div>
<script>
  window.onload = function () {
    // Auto float images
    var $figures = document.getElementsByTagName('figure');
    if (!$figures.length) return;
    function asideImages () {
      for (var i = 0, l = $figures.length; i < l; i++) {
        var $figure = $figures[i];
        var $images = $figure.getElementsByTagName('img');
        if ($images.length == 1) {
          var $img = $images[0];
          var width = Math.max($img.naturalWidth, $img.width);
          var height = Math.max($img.naturalHeight, $img.height);
          if (width <= 280 && (width / $figure.parentNode.offsetWidth * 100 < 50) && height < window.innerHeight * 0.9) {
            $figure.className = 'image-aside';
          } else if ($figure.className) {
            $figure.className = '';
          }
        }
      }
    };
    asideImages();
    window.onresize = asideImages;

    // Autoplay videos when in viewport
    // https://benfrain.com/automatically-play-and-pause-video-as-it-enters-and-leaves-the-viewport-screen/
    function playPauseVideo() {
      var videos = document.querySelectorAll("video");
      videos.forEach((video) => {
        video.muted = true;
        var playPromise = video.play();
        if (playPromise !== undefined) {
          playPromise.then((_) => {
            var observer = new IntersectionObserver(
              (entries) => {
                entries.forEach((entry) => {
                  if (entry.isIntersecting) {
                    video.play();
                  } else {
                    video.pause();
                  }
                });
              },
              { threshold: 0.2 }
            );
            observer.observe(video);
          });
        }
      });
    }
    playPauseVideo();
  };
  if (navigator.serviceWorker) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('/sw.js', {
        scope: '/'
      });
    });
  }
</script>
<script data-goatcounter="https://cheeaun.goatcounter.com/count" async src="//gc.zgo.at/count.v2.js" crossorigin="anonymous" integrity="sha384-PeYXrhTyEaBBz91ANMgpSbfN1kjioQNPHNDbMvevUVLJoWrVEjDCpKb71TehNAlj"></script>
<script defer data-domain="cheeaun.com" src="https://plausible.io/js/plausible.js"></script>
</html>